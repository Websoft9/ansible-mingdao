- name: Create a directory if it does not exist
  file:
    path: /usr/local/mingdao
    state: directory
    
- name: Pull mingdao docker image
  shell: |
    docker pull mdpublic/mingdaoyun-community:"{{mingdao_docker_community_version}}"
    docker pull mdpublic/mingdaoyun-doc:"{{mingdao_docker_doc_version}}"
  
- name: Download mingdao installation tool from {{mingdao_download_url}}
  shell: |
    curl {{mingdao_download_url}} | tar xvz
    cp service.sh /usr/local/mingdao
    bash ./service.sh start
  args:
    chdir: /tmp

- name: add startup scripts sys.sh to Server
  template:
    src: sys.sh
    dest: /usr/local/mingdao

- name: add sys.sh to /etc/rc.local
  shell: echo "/bin/bash /usr/local/mingdao/sys.sh > /usr/local/mingdao/service.log 2>&1" > /etc/rc.local
